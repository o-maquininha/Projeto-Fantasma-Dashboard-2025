---
# Nome do arquivo PDF gerado na pasta resultado
output-file: "Entrega 1"
---

```{r setup}
#| include: false

source("rdocs/source/packages.R")
knitr::opts_chunk$set(echo = TRUE, cache=T, message=F, warning=F, error=F)
if (!require("pacman")) install.packages("pacman")
pacman::p_load("readxl", "tidyverse", "knitr", "kableExtra")
options(scipen=0)
```

```{r echo=FALSE}
faixa_peso <- function(imc){
  if(imc < 18.5){
    return("Abaixo do peso")
  } else if(imc >= 18.5 & imc < 24.9){
    return("Peso normal")
  } else if(imc >= 25 & imc < 29.9){
    return("Sobrepeso")
  } else {
    return("Obesidade")
  }
}

relatorio_vendas <- read_excel(path = "relatorio_old_town_road.xlsx", sheet = "relatorio_vendas")
info_vendas <- read_excel(path = "relatorio_old_town_road.xlsx", sheet = "infos_vendas")
info_produtos <- read_excel(path = "relatorio_old_town_road.xlsx", sheet = "infos_produtos")
info_funcionarios <- read_excel(path = "relatorio_old_town_road.xlsx", sheet = "infos_funcionarios")
info_cidades <- read_excel(path = "relatorio_old_town_road.xlsx", sheet = "infos_cidades")
info_clientes <- read_excel(path = "relatorio_old_town_road.xlsx", sheet = "infos_clientes")
info_lojas <- read_excel(path = "relatorio_old_town_road.xlsx", sheet = "infos_lojas")

relatorio_vendas$Date <- ymd(relatorio_vendas$Date)

relatorio_vendas <- relatorio_vendas %>% 
  inner_join(info_vendas, by = c("SaleID" = "Sal3ID")) %>% 
  inner_join(info_lojas, by = c("StoreID" = "Stor3ID")) %>% 
  inner_join(info_cidades, by = c("CityID" = "C1tyID")) %>% 
  inner_join(info_produtos, by = c("ItemID" = "Ite3ID")) %>% 
  inner_join(info_clientes, by = c("ClientID" = "Cli3ntID"))

relatorio_vendas <- relatorio_vendas %>% 
  mutate(ano = year(Date)) %>%
  mutate(UnityPrice = UnityPrice * 5.31) %>% 
  mutate(receitaVenda = Quantity * UnityPrice) %>% 
  mutate(Height_dm = Height_dm * 10) %>% 
  mutate(Weight_lbs = Weight_lbs * 0.453592) %>% 
  rename(altura_cm = Height_dm,
         peso_kg = Weight_lbs) %>% 
  mutate(IMC = peso_kg/(altura_cm/100)^2) %>% 
  mutate(FaixaPeso = sapply(IMC, faixa_peso))
```

# Introdução

\ \ \ \ O objetivo deste relatório é apresentar uma análise dos dados, visando compreender o comportamento das vendas e dos clientes da região. O escopo das análises foi a **receita média** das lojas, a variação do **peso** por **altura**, a idade dos clientes de **Âmbar Seco** e os três **produtos mais vendidos** nas lojas com maior receita. As técnicas empregadas incluíram análises exploratórias, medidas descritivas, gráficos de dispersão e boxplots, testes de normalidade, correlação de Pearson e intervalos de confiança.

\ \ \ \ Os dados foram fornecidos pela **ESTAT – Consultoria Estatística**. O conjunto de dados é composto por 19.885 observações de compras realizadas por 1.990 clientes, envolvendo 10 tipos de produtos comercializados em 18 lojas distribuídas entre 5 cidades da região de interesse. Para mais informações sobre as variáveis, consulte o **Anexo 1**. A análise dos dados foi realizada na versão 4.5.0 do R, mais informações sobre os pacotes e ambiente utilizados estão no **Anexo 2**.

# Referencial Teórico

## Frequência Relativa

A frequência relativa é utilizada para a comparação entre classes de uma variável categórica com $c$ categorias, ou para comparar uma mesma categoria em diferentes estudos.

A frequência relativa da categoria $j$ é dada por:

$$
f_j=\frac{n_j}{n}
$$

Com:

-   $j = 1, \, ..., \, c$

-   $n_j =$ número de observações da categoria $j$

-   $n =$ número total de observações

Geralmente, a frequência relativa é utilizada em porcentagem, dada por:

$$100 \times f_j$$

## Média

A média é a soma das observações dividida pelo número total delas, dada pela fórmula:

$$\bar{X}=\frac{\sum\limits_{i=1}^{n}X_i}{n}$$

Com:

-   $i = 1, \, 2, \, ..., \, n$

-   $n =$ número total de observações

## Mediana

Sejam as $n$ observações de um conjunto de dados $X=X_{(1)},X_{(2)},\ldots, X_{(n)}$ de determinada variável ordenadas de forma crescente. A mediana do conjunto de dados $X$ é o valor que deixa metade das observações abaixo dela e metade dos dados acima.

Com isso, pode-se calcular a mediana da seguinte forma:

$$
med(X) =
    \begin{cases}
         X_{\frac{n+1}{2}}, \textrm{para n ímpar} \\
         \frac{X_{\frac{n}{2}}+X_{\frac{n}{2} + 1}}{2}, \textrm{para n par} \\
    \end{cases}
$$

## Quartis

Os quartis são separatrizes que dividem o conjunto de dados em quatro partes iguais. O primeiro quartil (ou inferior) delimita os 25% menores valores, o segundo representa a mediana, e o terceiro delimita os 25% maiores valores. Inicialmente deve-se calcular a posição do quartil:

-   Posição do primeiro quartil $P_1$: $$P_1=\frac{n+1}{4}$$

-   Posição da mediana (segundo quartil) $P_2$: $$P_2 = \frac{n+1}{2}$$

-   Posição do terceiro quartil $P_3$: $$P_3=\frac{3 \times (n+1)}{4}$$

Com $n$ sendo o tamanho da amostra. Dessa forma, $X_{\left( P_i \right)}$ é o valor do $i$-ésimo quartil, onde $X_{\left( j \right)}$ representa a $j$-ésima observação dos dados ordenados.

Se o cálculo da posição resultar em uma fração, deve-se fazer a média entre o valor que está na posição do inteiro anterior e do seguinte ao da posição.

## Variância

A variância é uma medida que avalia o quanto os dados estão dispersos em relação à média, em uma escala ao quadrado da escala dos dados.

### Variância Populacional

Para uma população, a variância é dada por:

$$\sigma^2=\frac{\sum\limits_{i=1}^{N}\left(X_i - \mu\right)^2}{N}$$

Com:

-   $X_i =$ $i$-ésima observação da população

-   $\mu =$ média populacional

-   $N =$ tamanho da população

### Variância Amostral

Para uma amostra, a variância é dada por:

$$S^2=\frac{\sum\limits_{i=1}^{n}\left(X_i - \bar{X}\right)^2}{n-1}$$

Com:

-   $X_i =$ i-ésima observação da amostra

-   $\bar{X} =$ média amostral

-   $n =$ tamanho da amostra

## Desvio Padrão

O desvio padrão é a raiz quadrada da variância. Ele avalia o quanto os dados estão dispersos em relação à média.

### Desvio Padrão Populacional

Para uma população, o desvio padrão é dado por:

$$\sigma=\sqrt{\frac{\sum\limits_{i=1}^{N}\left(X_i - \mu\right)^2}{N}}$$

Com:

-   $X_i =$ i-ésima observação da população

-   $\mu =$ média populacional

-   $N =$ tamanho da população

### Desvio Padrão Amostral

Para uma amostra, o desvio padrão é dado por:

$$S=\sqrt{\frac{\sum\limits_{i=1}^{n}\left(X_i - \bar{X}\right)^2}{n-1}}$$

Com:

-   $X_i =$ i-ésima observação da amostra

-   $\bar{X} =$ média amostral

-   $n =$ tamanho da amostra

## Coeficiente de Variação

O coeficiente de variação fornece a dispersão dos dados em relação à média. Quanto menor for o seu valor, mais homogêneos serão os dados. O coeficiente de variação é considerado baixo (apontando um conjunto de dados homogêneo) quando for menor ou igual a 25%. Ele é dado pela fórmula:

$$C_V=\frac{S}{\bar{X}}\times 100$$

Com:

-   $S =$ desvio padrão amostral

-   $\bar{X} =$ média amostral

## Boxplot

O boxplot é uma representação gráfica na qual se pode perceber de forma mais clara como os dados estão distribuídos. A figura abaixo ilustra um exemplo de boxplot.

![Exemplo de boxplot](images/box_uni.png){fig-align="center"}

A porção inferior do retângulo diz respeito ao primeiro quartil, enquanto a superior indica o terceiro quartil. Já o traço no interior do retângulo representa a mediana do conjunto de dados, ou seja, o valor em que o conjunto de dados é dividido em dois subconjuntos de mesmo tamanho. A média é representada pelo losango branco e os pontos são *outliers*. Os *outliers* são valores discrepantes da série de dados, ou seja, valores que não demonstram a realidade de um conjunto de dados.

## Histograma

O histograma é uma representação gráfica utilizada para a visualização da distribuição dos dados e pode ser construído por valores absolutos, frequência relativa ou densidade. A figura abaixo ilustra um exemplo de histograma.

![Exemplo de histograma](images/hist_uni.png){fig-align="center"}

## Gráfico de Dispersão

O gráfico de dispersão é uma representação gráfica utilizada para ilustrar o comportamento conjunto de duas variáveis quantitativas. A figura abaixo ilustra um exemplo de gráfico de dispersão, onde cada ponto representa uma observação do banco de dados.

![Exemplo de Gráfico de Dispersão](images/disp_uni.png){fig-align="center"}

## Tipos de Variáveis

### Qualitativas

As variáveis qualitativas são as variáveis não numéricas, que representam categorias ou características da população. Estas subdividem-se em:

-   **Nominais**: quando não existe uma ordem entre as categorias da variável (exemplos: sexo, cor dos olhos, fumante ou não, etc)
-   **Ordinais**: quando existe uma ordem entre as categorias da variável (exemplos: nível de escolaridade, mês, estágio de doença, etc)

### Quantitativas

As variáveis quantitativas são as variáveis numéricas, que representam características numéricas da população, ou seja, quantidades. Estas subdividem-se em:

-   **Discretas**: quando os possíveis valores são enumeráveis (exemplos: número de filhos, número de cigarros fumados, etc)
-   **Contínuas**: quando os possíveis valores são resultado de medições (exemplos: massa, altura, tempo, etc)

## Coeficiente de Correlação de Pearson

O coeficiente de correlação de Pearson é uma medida que verifica o grau de relação linear entre duas variáveis quantitativas. Este coeficiente varia entre os valores -1 e 1. O valor zero significa que não há relação linear entre as variáveis. Quando o valor do coeficiente $r$ é negativo, diz-se existir uma relação de grandeza inversamente proporcional entre as variáveis. Analogamente, quando $r$ é positivo, diz-se que as duas variáveis são diretamente proporcionais.

O coeficiente de correlação de Pearson é normalmente representado pela letra $r$ e a sua fórmula de cálculo é:

$$
r_{Pearson} = \frac{\displaystyle \sum_{i=1}^{n} \left [ \left(x_i-\bar{x}\right) \left(y_i-\bar{y}\right) \right]}{\sqrt{\displaystyle \sum_{i=1}^{n} x_i^2 - n\bar{x}^2}  \times \sqrt{\displaystyle \sum_{i=1}^{n} y_i^2 - n\bar{y}^2}}
$$

Onde:

-   $x_i =$ i-ésimo valor da variável $X$
-   $y_i =$ i-ésimo valor da variável $Y$
-   $\bar{x} =$ média dos valores da variável $X$
-   $\bar{y} =$ média dos valores da variável $Y$

Vale ressaltar que o coeficiente de Pearson é paramétrico e, portanto, sensível quanto à normalidade (simetria) dos dados.

## Teste de Hipóteses

O teste de hipóteses tem como objetivo fornecer uma metodologia para verificar se os dados das amostras possuem indicativos que comprovem, ou não, uma hipótese previamente formulada. Ele é composto por duas hipóteses:

```{=latex}
\hipoteses{hipótese a ser testada (chamada de hipótese nula)}{hipótese alternativa que será aceita caso a hipótese nula seja rejeitada}
```
Essa decisão é tomada por meio da construção de uma região crítica, ou seja, região de rejeição do teste.

## Tipos de teste: bilateral e unilateral

Para a formulação de um teste, deve-se definir as hipóteses de interesse. Em geral, a hipótese nula é composta por uma igualdade (por exemplo, $H_{0}: \theta = \theta_{0}$). Já a hipótese alternativa depende do grau de conhecimento que se tem do problema em estudo. Assim, tem-se três formas de elaborar $H_{1}$ que classificam os testes em duas categorias:

-   **Teste Bilateral**:\
    Esse é o teste mais geral, em que a hipótese alternativa consiste em verificar se existe diferença entre os parâmetros de interesse, independentemente de um ser maior ou menor que o outro. Dessa forma, tem-se:

    $$ H_{1}: \theta \neq \theta_{0} $$

-   **Teste Unilateral**:\
    Dependendo das informações que o pesquisador possui a respeito do problema e os questionamentos que possui, a hipótese alternativa pode ser feita de forma a verificar se existe diferença entre os parâmetros em um dos sentidos. Ou seja:

    $$ H_{1}: \theta < \theta_{0} $$ ou $$ H_{1}: \theta > \theta_{0} $$ \## Tipos de Erros Ao realizar um teste de hipóteses, existem dois erros associados: **Erro do Tipo I** e **Erro do Tipo II**.

-   **Erro do Tipo I**:\
    Esse erro é caracterizado por rejeitar a hipótese nula ($H_{0}$) quando essa é verdadeira. A probabilidade associada a esse erro é denotada por $\alpha$, também conhecido como nível de significância do teste.

-   **Erro do Tipo II**:\
    Ao não rejeitar $H_{0}$ quando, na verdade, é falsa, está sendo cometido o **Erro do Tipo II**. A probabilidade de se cometer este erro é denotada por $\beta$.

## Nível de significância ($\alpha$)

O nível de significância do teste é o nome dado à probabilidade de se rejeitar a hipótese nula quando essa é verdadeira; essa rejeição é chamada de **erro do tipo I**. O valor de $\alpha$ é fixado antes da extração da amostra e, usualmente, assume 5%, 1% ou 0,1%.

Por exemplo, um nível de significância de $\alpha=0,05$ (5%) significa que, se for tomada uma grande quantidade de amostras, em 5% delas a hipótese nula será rejeitada quando não havia evidências para essa rejeição, isto é, a probabilidade de se tomar a decisão correta é de 95%.

## Estatística do Teste

A estatística do teste é o estimador que será utilizado para testar se a hipótese nula ($H_{0}$) é verdadeira ou não. Ela é escolhida por meio das teorias estatísticas.

## P-valor

O **P-valor**, ou nível descritivo, é uma medida utilizada para sintetizar o resultado de um teste de hipóteses. Ele também pode ser chamado de *probabilidade de significância* do teste e indica a probabilidade de se obter um resultado da estatística de teste mais extremo do que o observado na presente amostra, considerando que a hipótese nula é verdadeira. Dessa forma, rejeita-se $H_{0}$ quando $P\text{-valor} < \alpha$, porque a chance de uma nova amostra possuir valores tão extremos quanto o encontrado é baixa, ou seja, há evidências para a rejeição da hipótese nula.

## Intervalo de Confiança

Quando calcula-se um estimador pontual para o parâmetro, não é possível definir qual a possível magnitude do erro que se está cometendo. Com o objetivo de associar um erro à estimativa, são construídos os intervalos de confiança que se baseiam na distribuição amostral do estimador pontual.

Dessa forma, considere $T$ um estimador pontual para $\theta$ e que a distribuição amostral de $T$ é conhecida. O intervalo de confiança para o parâmetro $\theta$ será dado por $t_{1}$ e $t_{2}$, tal que:

$$ P(t_{1} < \theta < t_{2}) = \gamma $$

A probabilidade $\gamma$ é estabelecida no início do estudo e representa o nível de confiança do intervalo. A interpretação desse resultado é que, se forem tiradas várias amostras de mesmo tamanho e forem calculados intervalos de confiança para cada uma, $100 \times \gamma \%$ dos intervalos irão conter o parâmetro $\theta$. Assim, ao calcular um intervalo, pode-se dizer que há $100 \times \gamma \%$ de confiança de que o intervalo contém o parâmetro de interesse.

## Teste de Correlação de Pearson

O coeficiente de correlação linear de Pearson indica a força e a direção do relacionamento linear entre duas variáveis quantitativas. É um índice adimensional com valores situados entre -1 e 1, no qual o valor -1 representa total correlação linear negativa entre as variáveis (quando o valor de uma variável cresce, o valor da outra diminui) e o valor 1 representa total correlação linear positiva entre elas (ambas crescem simultaneamente). Esse coeficiente é obtido por meio da fórmula:

$$r_{Pearson} = \frac{\displaystyle \sum_{i=1}^{n} \left [ \left(x_i-\bar{x}\right) \left(y_i-\bar{y}\right) \right]}{\sqrt{\displaystyle \sum_{i=1}^{n} x_i^2 - n\bar{x}^2} \sqrt{\displaystyle \sum_{i=1}^{n} y_i^2 - n\bar{y}^2}}$$

\noindent em que

-   $x_i=$ i-ésimo valor da variável $X$

-   $y_i=$ i-ésimo valor da variável $Y$

-   $\bar{x}=$ média dos valores da variável $X$

-   $\bar{y}=$ média dos valores da variável $Y$

-   $r_{Pearson}=$ coeficiente de correlação linear de Pearson amostral

Para o teste de correlação de Pearson, tem-se as seguintes hipóteses:

\hipoteses{Não há correlação linear entre as variáveis $X$ e $Y$ $\left(\rho_{Pearson} = 0 \right)$ }{Há correlação linear entre as variáveis $X$ e $Y$ $\left(\rho_{Pearson} \neq 0 \right)$ }

em que $\rho_{Pearson}$ é o parâmetro a ser testado: coeficiente de correlação linear populacional.

Se X e Y tem distribuição normal, tem-se que a estatística do teste é dada por:

$$t_{Pearson} = \frac{r_{Pearson} \sqrt{n-2}}{\sqrt{1-r_{Pearson}^2}} \sim t_{n-2} $$

Assim, sob $H_{0}$, $t_{Pearson}$ segue uma distribuição \textit{t}-Student com ($n - 2$) graus de liberdade.

# Análises

## A receita média das lojas registrada nos anos de 1880 até 1889

```{r}
#| echo: false

tabela1 <-  relatorio_vendas %>% 
  group_by(ano, NameStore, NameProduct, NameCity) %>%
  summarise(
    receitaAnual = sum(receitaVenda)
  ) #%>% View

tabela2 <- tabela1 %>% 
  group_by(NameStore) %>% 
  summarise(
    Média = mean(receitaAnual),
    Mediana = median(receitaAnual),
    DP = sd(receitaAnual),
  ) %>% 
  arrange(desc(Média)) #%>% View

tabela3 <- relatorio_vendas %>%
  group_by(ano) %>% 
  summarise(
    receitaAnual = sum(receitaVenda)/18
  ) #%>% View

tabela4 <- relatorio_vendas %>% 
  group_by(NameProduct) %>%
  summarise(
    Quantidade = sum(Quantity)
    ) %>% 
  arrange(desc(Quantidade)) #%>% View

tabela5 <- tabela1 %>% 
  group_by(NameProduct) %>%
  summarise(
    Média = mean(receitaAnual),
    Mediana = median(receitaAnual),
    DP = sd(receitaAnual),
  ) %>% 
  arrange(desc(Média)) #%>% View

tabela6 <- relatorio_vendas %>% 
  group_by(NameCity) %>%
  summarise(
    Quantidade = sum(Quantity)
    ) %>% 
  arrange(desc(Quantidade)) #%>% View

tabela7 <- tabela1 %>% 
  group_by(NameCity) %>%
  summarise(
    Média = mean(receitaAnual),
    DP = sd(receitaAnual),
    Mínimo = min(receitaAnual),
    Mediana = median(receitaAnual),
    Máximo = max(receitaAnual)
  ) %>% 
  arrange(desc(Média)) #%>% View

tabela8 <- tabela1 %>% 
  filter(ano %in% c(1880, 1889)) %>%
  group_by(NameCity) %>%
  summarise(
    "Taxa de cerscimento (%)" = ((sum(receitaAnual[ano == 1889]) -sum(receitaAnual[ano == 1880]))/sum(receitaAnual[ano == 1880])) * 100
  ) %>% arrange(desc(`Taxa de cerscimento (%)`)) #%>% View

```

\ \ \ \ O objetivo desta análise é compreender o comportamento da região ao longo da série temporal por meio da **receita média**. Essa variável foi calculada pela soma da receita anual da região dividida pelo número de lojas (18). Receita média é uma variável **quantitativa contínua**, por esse motivo, para facilitar a interpretação dos resultados, foram utilizados gráficos de dispersão e tabelas. A Figura 4 apresenta a evolução da receita média ao longo dos anos, com o tempo no eixo x e a receita média no eixo y, enquanto a Tabela 1 exibe os valores correspondentes (em reais) no período de 1880 a 1889.

```{r}
#| echo: false
#| label: fig-grafico-4
#| fig-cap: Receita média da região

relatorio_vendas %>% 
  group_by(ano) %>% 
  summarise(receita = sum(receitaVenda)/18) %>%
  ggplot(aes(ano, receita)) +
  scale_x_continuous(breaks = c(1880:1889)) +
  # geom_smooth(method = lm, se = FALSE, colour = "lightgrey") +
  geom_point(size = 1.5, colour = "#A11D21") +
  geom_line(colour = "#A11D21") +
  labs(x = "Ano", y = "Receita Média") +
  theme_estat()

```

\newpage

```{r}
#| echo: false
#| results: asis
#| label: tbl-tabela-1
#| tbl-cap: Receita méida da região nos anos de 1880 a 1889
#| cap-location: top

colnames(tabela3) <- c("Ano", "Receita média (R$)")
tabela3 %>% kable(digits = c(0, 2))
```

\ \ \ \ A receita média da região apresentou um crescimento expressivo ao longo do período analisado, com um aumento total de R\$49.610,10 desde o início da série histórica. É importante destacar que, em 1888, ocorreu a primeira redução na receita média da região durante todo o período analisado, entretanto, no ano seguinte (1889), observou-se um aumento explosivo na receita média. Esses resultados indicam que a região apresenta **grande potencial** de investimento.

## Variação Peso por Altura

```{r}
#| echo: false

aux <- relatorio_vendas %>% 
  select(ClientID, peso_kg, altura_cm, IMC, FaixaPeso) %>% 
  distinct()

p_media <- mean(aux$peso_kg)
p_sd <- sd(aux$peso_kg)
p_var <- var(aux$peso_kg)
h_media <- mean(aux$altura_cm)
h_sd <- sd(aux$altura_cm)
h_var <- var(aux$altura_cm)

np_test <- lillie.test(aux$peso_kg)
nh_test <- lillie.test(aux$altura_cm)

p_est <- np_test$statistic
p_pv <- np_test$p.value
h_est <- nh_test$statistic
h_pv <- nh_test$p.value

quadro1 <- aux %>% 
  summarise(
    Média = p_media,
    Mediana = median(peso_kg),
    `Desvio Padrão` = p_sd,
    Variância = p_var,
    Mínimo = min(peso_kg),
    Máximo = max(peso_kg),
    `1º Quartil` = quantile(peso_kg, 0.25),
    `3º Quartil` = quantile(peso_kg, 0.75)
  ) %>% t()
  
quadro2 <- aux %>% 
  summarise(
    Média = h_media,
    Mediana = median(altura_cm),
    `Desvio Padrão` = h_sd,
    Variância = h_var,
    Mínimo = min(altura_cm),
    Máximo = max(altura_cm),
    `1º Quartil` = quantile(altura_cm, 0.25),
    `3º Quartil` = quantile(altura_cm, 0.75)
  ) %>% t()

cor_test <- cor.test(aux$peso_kg, aux$altura_cm, method = "pearson", conf.level = 0.95)
cor_hat <- cor_test$estimate
cor_IC <- cor_test$conf.int
cor_pv <- cor_test$p.value
cor_est <- cor_test$statistic

tabela9 <- data.frame(
  `p-valor` = c(p_pv, h_pv),
  `Estatística D` = c(p_est, h_est),
  `Decisão` = c("Não rejeitar H0", "Não rejeitar H0") 
) %>%
  rownames_to_column("Variável") %>%
  mutate(Variável = c("Peso", "Altura"))

tabela10 <- data.frame(
  `Correlação de Pearson` = cor_hat,
  `p-valor` = "< 0,0001",
  `Estatística t` = cor_est) %>% t()
```

\ \ \ \ O objetivo desta análise é investigar se existe relação linear entre o **peso** e a **altura** dos clientes, em que o peso foi convertido para quilogramas (multiplicando o valor em libras por 0,453592) e a altura convertido para centímetros (multiplicando o valor em decímetros por 10). Ambas variáveis são **quantitativas continuas**.

```{r}
#| echo: false
#| label: fig-grafico-5
#| fig-cap: Disperssão entre peso e altura dos clientes

aux %>% 
  group_by(ClientID) %>% 
  ggplot(aes(x = peso_kg, y = altura_cm)) +
  geom_point(colour = "#A11D21", alpha = .5) +
  # geom_jitter(width = .5, height = .5, colour = "#A11D21", alpha = .3) +
  labs(x = "Peso (kg)", y = "altura (cm)") +
  theme_estat()
```

Quadro 1: Principais métricas do peso dos clientes

\vspace{.2cm}
```{=latex}
\begin{center}
\begin{tabular} { | l |
			S[table-format = 2.2]
			|}
	\hline
		\textbf{Estatística} & \textbf{Valor} \\
		\hline
		Média & 75,19 \\
		Desvio Padrão & 11,92 \\
		Variância & 142 \\
		Mínimo & 45 \\
		1º Quartil & 66,9 \\
		Mediana & 75,3 \\
		3º Quartil & 83,2 \\
		Máximo & 119,3 \\
	\hline
\end{tabular}
\end{center}
```
\vspace{.2cm}

Quadro 2: Principais métricas da altura dos clientes

\vspace{.2cm}
```{=latex}
\begin{center}
\begin{tabular} { | l |
			S[table-format = 2.2]
			|}
	\hline
		\textbf{Estatística} & \textbf{Valor} \\
		\hline
		Média & 171,48 \\
		Desvio Padrão & 9,87 \\
		Variância & 97,38 \\
		Mínimo & 150 \\
		1º Quartil & 164,8 \\
		Mediana & 171,75 \\
		3º Quartil & 178 \\
		Máximo & 200 \\
	\hline
\end{tabular}
\end{center}
```
\vspace{.2cm}

\ \ \ \ Ao observar o gráfico de dispersão entre **peso** e **altura**, nota-se de imediato uma relação positiva entre as variáveis, assim como uma alta variabilidade. A medida que o peso aumenta a altura tende a aumentar e os pontos estão bem espalhados, indicando que, embora exista uma correlação positiva, o peso varia bastante mesmo entre clientes com estaturas semelhantes.

\ \ \ \ A normalidade das variáveis **peso** e **altura** foi verificada a fim de assegurar a adequação dos dados às suposições do teste. Em seguida, realizou-se o teste de correlação de Pearson, considerando as seguintes hipóteses.

```{=latex}
\begin{center}
\hipoteses{$\rho = 0$}{$\rho \neq 0$}
\end{center}
```

Quadro 3: Resultados do teste de correlação de Pearson entre peso e altura

\vspace{.2cm}
```{=latex}
\begin{center}
    \begin{tabular}{|c c c|}
        \hline
        \textbf{Estatística t} & \textbf{P-valor} & \textbf{Decisão do teste} \\
        \hline
        43,35 & < 0,0001 & Rejeita $H_0$ \\
        \hline
    \end{tabular}
\end{center}
```
\vspace{.2cm}

\ \ \ \ Sob $H_0$, foi obtido um p-valor $< 2,2 \times 10^{-16}$. Ao nível de significância de 5% há evidencia estatística suficiente para rejeitar a hipótese nula, indicando que há correlação linear entre as variáveis. O **estimador** do coeficiente de correlação, o **p-valor** e a **estatística do teste** estão apresentados na Tabela 2. O intervalo de confiança, ao nível de 95%, é mostrado a seguir.

```{=latex}
\begin{center}
    \begin{tabular}{|c I|}
        \toprule
        \textbf{Parâmetro} & \textbf{Intervalo de Confiança (95\%)} \\
        \midrule
        $\rho$ & \interval{0.6737991}{0.7190173} \\ % substitua o "a" pelo limite inferior e o "b" pelo limite superior
        \bottomrule
    \end{tabular}
\end{center}
```

\ \ \ \ O estimador da correlação de Pearson ($0,5 < \hat{\rho} < 0,7$) indica que na população de clientes há uma relação linear positiva moderada, quase alta, entre o **peso** e a **altura**. Isso é, à medida que a altura dos clientes aumenta, o peso também tende a aumentar. O p-valor muito baixo fornece evidência estatística que a correlação linear é não nula, sugerindo que que a relação observada dificilmente ocorreu ao acaso. O intervalo de confiança indica que com 95% de confiança no procedimento de estimação, o valor verdadeiro da correlação populacional estaria dentro do intervalo $[0,6737991; 0,7190173]$. Assim, podemos conlcuir que, em geral, **clientes mais altos pesam mais**.

## Idade dos clientes de Âmbar Seco a depender da loja

```{r}
#| echo: false

ambar_seco <- relatorio_vendas %>%
  filter(NameCity == "Âmbar Seco")

tabela11 <- ambar_seco %>%
  group_by(NameStore) %>%
  summarise(
    Média = mean(Age),
    Mediana = median(Age),
    DP = sd(Age),
    DIQ = IQR(Age)
  ) %>%
  arrange(desc(Média)) #%>% View
```

\ \ \ \ Para esta análise, o objetivo é examinar a distribuição da **idade** dos **clientes** por **lojas** na cidade de **Âmbar Seco**. Idade é variável **quantitativa discreta** e Clientes é variável **qualitativa nominal**.

```{r}
#| echo: false
#| label: fig-grafico-6
#| fig-cap: Boxplot da idade dos clientes em Âmbar Seco

ambar_seco %>% 
  group_by(NameStore, Age) %>%
  ggplot(aes(NameStore, Age)) +
  geom_boxplot(fill = "#A11D21", width = .5) +
  stat_summary(fun = "mean", geom = "point", shape = 23, size = 3, fill = "grey") +
  labs(x = "Loja", y = "Idade") +
  theme_estat()
```

\vspace{.5cm}
Quasdro 4: Principais métricas da idade dos clientes em Âmbar Seco por loja
\vspace{.2cm}

```{=latex}
\begin{center}
\begin{tabular} { | l |
			S[table-format = 2.2]
			S[table-format = 2.2]
			S[table-format = 3.2]
			S[table-format = 2.2]
			|}
	\hline
		\textbf{Estatística} & \textbf{Banco Careca} & \textbf{Vendinha Rápida} & \textbf{Saloon} & \textbf{Ferraria Seca} \\
		\hline
		Média & 34,99 & 39,76 & 35,64 & 33,95 \\
		Desvio Padrão & 5,47 & 6,05 & 12 & 13,51 \\
		Variância & 29,91 & 36,64 & 144,12 & 182,54 \\
		Mínimo & 25 & 30 & 15 & 16 \\
		1º Quartil & 31 & 34 & 27 & 24 \\
		Mediana & 34 & 40 & 34 & 31 \\
		3º Quartil & 40 & 44 & 39 & 39 \\
		Máximo & 44 & 49 & 77 & 80 \\
	\hline
	\end{tabular}
\end{center}
```


\ \ \ \ Da Figura 6 e dos valores de **Q1** e **Q3** apresentados no Quadro 2, observa-se que as lojas **Vendinha Rápida** e **Banco Careca** apresentam distribuições de idades mais concentradas. Isso pode ser percebido pelas caixas menores no boxplot e pela menor amplitude entre o primeiro e o terceiro quartil, indicando que a maioria dos clientes se concentra em uma faixa etária mais estreita.

\ \ \ \ Em contrapartida, as lojas **Saloon** e **Ferraria Seca** exibem maior dispersão na idade dos clientes, com caixas mais miores, maior distância entre **Q1** e **Q3** e alta amplitude, 62 e 64 anos respectivamente.

\ \ \ \ A loja **Vendinha Rápida** se destaca por apresentar a maior **média** (39,76) e **mediana** (40) de idade, sugerindo que seus clientes tendem a ser mais velhos em comparação às demais lojas da cidade de Âmbar Seco. Já a **Ferraria Seca** possui a menor **média** (33,95) e **mediana** (31), indicando um público mais jovem; contudo, a maior amplitude interquartílica e o desvio padrão mais elevado (13,51) sugerem um perfil etário mais diversificado e heterogêneo.

## Os top 3 produtos mais vendidos nas top 3 lojas com maior receita em 1889

```{r}
#| echo: false

tabela12 <- relatorio_vendas %>%
  filter(ano == 1889) %>%
  group_by(NameStore) %>%
  summarize(receitaLoja = sum(receitaVenda)) %>%
  arrange(desc(receitaLoja)) %>% 
  slice(1:3)

top3_lojas <- tabela12 %>%
  slice(1:3) %>%
  pull(NameStore)

aux2 <- relatorio_vendas %>% 
  select(SaleID, NameStore, NameProduct, Quantity, ano, receitaVenda) %>%
  group_by(NameStore) %>% 
  mutate(receitaLoja = sum(receitaVenda)) %>% 
  filter(ano == 1889, NameStore %in% top3_lojas)

tabela13 <- aux2 %>% 
  group_by(NameProduct) %>%
  summarize(quantidadeVendida = sum(Quantity),
            receitaGerada = sum(receitaVenda)) %>%
  arrange(desc(quantidadeVendida))

top3_produtos_fa <- aux2 %>% 
  filter(NameStore == "Ferraria Apache") %>% 
  group_by(NameProduct) %>%
  summarize(quantidadeVendida = sum(Quantity)) %>%
  arrange(desc(quantidadeVendida)) %>%
  slice(1:3) %>% 
  pull(NameProduct)

top3_produtos_of <- aux2 %>% 
  filter(NameStore == "Loja Ouro Fino") %>% 
  group_by(NameProduct) %>%
  summarize(quantidadeVendida = sum(Quantity)) %>%
  arrange(desc(quantidadeVendida)) %>%
  slice(1:3) %>% 
  pull(NameProduct)

top3_produtos_tt <- aux2 %>% 
  filter(NameStore == "Loja TendTudo") %>% 
  group_by(NameProduct) %>%
  summarize(quantidadeVendida = sum(Quantity)) %>%
  arrange(desc(quantidadeVendida)) %>%
  slice(1:3) %>% 
  pull(NameProduct)

tabela14 <- aux2 %>% 
  mutate(NameStore = factor(NameStore, 
                            levels = c("Loja Ouro Fino", "Loja TendTudo", "Ferraria Apache"))) %>%
  group_by(NameStore, NameProduct) %>%
  summarize(
    quantidadeVendida = sum(Quantity),
    receitaGerada = sum(receitaVenda),
    .groups = "drop"
  ) %>% 
  arrange(NameStore, desc(quantidadeVendida)) %>% 
  slice(c(1:3, 11:13, 21:23))

classes_of <- aux2 %>%
  filter(NameStore == "Loja Ouro Fino", NameProduct %in% top3_produtos_of) %>% 
  group_by(NameProduct) %>%
  summarise(n = sum(Quantity)) %>%  # soma a quantidade vendida
  mutate(
    freq = n / sum(n),               # calcula proporção
    freq = freq * 100,               # transforma em porcentagem
    freq = round(freq, 2),           # arredonda
    freq = gsub("\\.", ",", freq) %>% paste0("%"), 
    label = str_c(n, " (", freq, ")") %>% str_squish()
  )

classes_tt <- aux2 %>%
  filter(NameStore == "Loja TendTudo", NameProduct %in% top3_produtos_of) %>% 
  group_by(NameProduct) %>%
  summarise(n = sum(Quantity)) %>%  # soma a quantidade vendida
  mutate(
    freq = n / sum(n),               # calcula proporção
    freq = freq * 100,               # transforma em porcentagem
    freq = round(freq, 2),           # arredonda
    freq = gsub("\\.", ",", freq) %>% paste0("%"), 
    label = str_c(n, " (", freq, ")") %>% str_squish()
  )

classes_fa <- aux2 %>%
  filter(NameStore == "Ferraria Apache", NameProduct %in% top3_produtos_of) %>% 
  group_by(NameProduct) %>%
  summarise(n = sum(Quantity)) %>%  # soma a quantidade vendida
  mutate(
    freq = n / sum(n),               # calcula proporção
    freq = freq * 100,               # transforma em porcentagem
    freq = round(freq, 2),           # arredonda
    freq = gsub("\\.", ",", freq) %>% paste0("%"), 
    label = str_c(n, " (", freq, ")") %>% str_squish()
  )
```

\ \ \ \ Por fim, o objetivo desta análise é identificar os três **produtos mais vendidos** nas três **lojas com maior receita** no ano de 1889. As lojas que apresentaram as maiores receitas nesse ano foram: **Loja Ouro Fino** (R\$ 197.312,50), **Loja TendTudo** (R\$ 196.340,30) e **Ferraria Apache** (R\$ 181.689,10).

```{r}
#| echo: false
#| results: asis
#| label: tbl-tabela-5
#| tbl-cap: Top 3 produtos nas top 3 lojas com maior receita em 1889

colnames(tabela14) <- c("Loja", "Produto", "Quantidade Vendida", "Receita Gerada (R$)")
tabela14 %>% kable(digits = c(0, 0, 0, 2)) %>% collapse_rows(columns = 1)
```

\newpage

```{r}
#| echo: false
#| results: asis
#| label: tbl-tabela-6
#| tbl-cap: Produtos mais vendidos nas top 3 lojas com maior receita em 1889

colnames(tabela13) <- c("Produto", "Quantidade Vendida", "Receita Gerada (R$)")
tabela13 %>% kable(digits = c(0, 0, 2))
```

\ \ \ \  Da Tabela 4, observa-se que o produto mais vendido na loja com maior receita em 1889 (**Loja Ouro Fino**) foram as **Botas de Couro**, com 52 unidades vendidas, o que corresponde a **6,02%** da receita anual. Entre as três lojas analisadas, o produto com maior volume de vendas foi a **Espingarda**, da **Loja TendTudo**, com 53 unidades vendidas. 

\ \ \ \ Pode-se observar da tabela 5 que o **Whisky** foi o produto mais vendido das três lojas em análise. O desempenho desse produto nas diferentes lojas sugere que é um item popular entre os consumidores da região, assim como o **Chapeu de Coro** e a **Espingarda** que aparecem mais de uma vez na Tabela 4.

# Conclusão

\ \ \ \ Ao longo deste relatório, foram exploradas diversas análises estatísticas para compreender o comportamento das vendas e dos clientes da região durante o período de 1880 a 1889. A análise da receita média revelou um crescimento significativo ao longo dos anos, indicando um potencial econômico promissor.

\ \ \ \ A investigação da relação entre **peso** e **altura** dos clientes revelou alta variabilidade, indicando que indivíduos com pesos semelhantes podem apresentar alturas bastante distintas. Além disso, observou-se uma correlação positiva moderada, sugerindo que, de modo geral, clientes mais altos tendem a pesar mais.

\ \ \ \ O perfil etário dos clientes em **Âmbar Seco** variou significativamente entre as lojas, com as lojas **Ferraria Seca** e **Saloon** apresentando uma faixas etárias mais amplas, enquanto **Banco Careca** e **Vendinha Rápida** uma faixa etária mais concentrada.

\ \ \ \ Finalmente, a análise dos produtos mais vendidos nas lojas com maior receita em 1889 destacou itens populares entre os consumidores, como o **Whisky**, a **Espingarda** e o **Chapeu de Couro**. 

# Anexo

1.  Dicionário das variáveis do banco de dados

-   ClienteID: Chave do cliente
-   Name: O nome do cliente
-   Age: A idade do cliente em anos
-   Sex: Sexo do Cliente
-   Height_dm: A altura do cliente em decímetros
-   Weight_lbs: O peso do cliente, em libras
-   Anual_Income_usd: Renda do cliente anualmente em dólares
-   CityID: Chave da cidade
-   NameCity: Nome da cidade
-   EmployeeID: Chave do funcionário
-   EmployeeName: Nome do funcionário
-   StoreID: Chave da loja
-   StoreName: Nome da loja
-   CityID: Chave da cidade
-   ItemID: Chave do produto
-   NameProduct: Nome do produto
-   UnityPrice: Preço unitário do produto em dólores
-   SaleID: Chave da venda
-   ItemID: Chave do produto
-   SaleID: Chave da venda
-   Date: A data da ocorrência da venda (YYYY-MM-DD)
-   StoreID: Chave da loja
-   ClientID: Chave do cliente
-   Quantity: Quantidade comprada deste produto

2. 
```{r}
#| echo: false

sessionInfo()
```